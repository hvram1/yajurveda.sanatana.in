---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import SidebarTA from '../../../components/SidebarTA.astro';
import fs from 'fs';
import path from 'path';

export function getStaticPaths() {
  const metadataPath = path.join(process.cwd(), 'src/data/ta/metadata.json');
  const metadata = JSON.parse(fs.readFileSync(metadataPath, 'utf-8'));
  
  return metadata.prapatakas.map(p => ({
    params: { prapaataka: String(p.prapaataka) }
  }));
}

const { prapaataka } = Astro.params;
const prapaatakaNum = parseInt(prapaataka);

const base = import.meta.env.BASE_URL;
const taBase = `${base}ta/`;

// Load metadata
const metadataPath = path.join(process.cwd(), 'src/data/ta/metadata.json');
const metadata = JSON.parse(fs.readFileSync(metadataPath, 'utf-8'));
const prapaatakaData = metadata.prapatakas.find(p => p.prapaataka === prapaatakaNum);
const maxPrapaataka = metadata.prapatakas.length;
---

<BaseLayout title={`TA प्रपाठकः ${prapaatakaNum}`} activeText="ta">
  <div class="page-with-sidebar">
    <SidebarTA currentPrapaataka={prapaatakaNum} />
    <div class="main-content">
      <nav class="breadcrumb mb-6 text-sm">
        <a href={base}>मुख्यपृष्ठम्</a>
        <span class="mx-2">›</span>
        <a href={taBase}>आरण्यक</a>
        <span class="mx-2">›</span>
        <span>प्रपाठकः {prapaatakaNum}</span>
      </nav>

      <div class="text-center mb-8">
        <div class="prapaataka-circle mx-auto mb-4">
          {prapaatakaNum}
        </div>
        <h1 class="text-3xl text-indigo mb-2">प्रपाठकः {prapaatakaNum}</h1>
        <p class="text-gray-600">Prapaataka {prapaatakaNum}</p>
        <p class="text-sm text-gray-500 mt-2">{prapaatakaData?.anuvakas.length} अनुवाकाः</p>
      </div>

      <div class="fancy mb-8"><span>॥</span></div>

      <section>
        <h2 class="text-xl text-indigo mb-6">अनुवाकाः (Anuvakas)</h2>
        <div class="grid grid-cols-2 md:grid-cols-5 lg:grid-cols-8 gap-3">
          {prapaatakaData?.anuvakas.map(anuvaka => (
            <a 
              href={`${taBase}anuvaka/${prapaatakaNum}/${anuvaka.anuvaka}`}
              class="verse-card text-center hover:shadow-lg transition-all py-3"
            >
              <div class="text-xl font-bold text-purple-600">{anuvaka.anuvaka}</div>
              <div class="text-xs text-gray-500 mt-1">{anuvaka.panchasats} पञ्चा°</div>
            </a>
          ))}
        </div>
      </section>

      <div class="flex justify-between mt-12 pt-4 border-t">
        {prapaatakaNum > 1 ? (
          <a href={`${taBase}prapaataka/${prapaatakaNum - 1}`} class="nav-link bg-purple-50 rounded">← प्रपाठकः {prapaatakaNum - 1}</a>
        ) : (
          <a href={taBase} class="nav-link bg-purple-50 rounded">← आरण्यक</a>
        )}
        {prapaatakaNum < maxPrapaataka ? (
          <a href={`${taBase}prapaataka/${prapaatakaNum + 1}`} class="nav-link bg-purple-50 rounded">प्रपाठकः {prapaatakaNum + 1} →</a>
        ) : (
          <a href={taBase} class="nav-link bg-purple-50 rounded">आरण्यक →</a>
        )}
      </div>
    </div>
  </div>
</BaseLayout>

<style>
  .page-with-sidebar { display: flex; min-height: calc(100vh - 200px); }
  .main-content { flex: 1; padding: 2rem; max-width: 900px; }
  .prapaataka-circle {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    font-weight: bold;
    color: white;
    background: linear-gradient(135deg, #8b5cf6 0%, #5b21b6 100%);
  }
  @media (max-width: 768px) {
    .page-with-sidebar { flex-direction: column; }
    .main-content { padding: 1rem; }
  }
</style>
