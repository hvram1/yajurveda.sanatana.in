---
interface Props {
  title: string;
  description?: string;
  activeText?: 'ts' | 'tb' | 'ta';
}

const { title, description = 'यजुर्वेद - कृष्ण यजुर्वेद तैत्तिरीय शाखा', activeText } = Astro.props;
const base = import.meta.env.BASE_URL;

const texts = [
  { id: 'ts', name: 'संहिता', nameEn: 'Samhita', path: `${base}ts/` },
  { id: 'tb', name: 'ब्राह्मण', nameEn: 'Brahmana', path: `${base}tb/` },
  { id: 'ta', name: 'आरण्यक', nameEn: 'Aranyaka', path: `${base}ta/` },
];
---

<!DOCTYPE html>
<html lang="sa">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <title>{title} | यजुर्वेद</title>
    <link rel="icon" type="image/png" href={`${base}images/favicon.png`} />
    <style set:html={`
      @font-face {
        font-family: 'AdiShilaVedic';
        src: url('${base}fonts/AdishilaVedic.ttf') format('truetype');
        font-weight: normal;
        font-style: normal;
      }
      @font-face {
        font-family: 'AdiShilaVedic';
        src: url('${base}fonts/AdishilaVedicBold.ttf') format('truetype');
        font-weight: bold;
        font-style: normal;
      }
    `}></style>
  </head>
  <body class="min-h-screen">
    <!-- Header banner with image -->
    <div class="header-banner">
      <div class="header-content">
        <a href={base}>
          <div class="header-logo-placeholder">॥</div>
        </a>
        <h1 class="header-title">यजुर्वेद</h1>
        <p class="header-tagline">Yajurvēda - कृष्ण यजुर्वेद तैत्तिरीय शाखा</p>
      </div>
    </div>

    <!-- Navigation bar -->
    <nav class="navbar sticky top-0 z-50">
      <div class="max-w-6xl mx-auto px-4 py-3 flex flex-wrap items-center justify-center gap-4">
        <a href={base} class="nav-link">मुख्यपृष्ठम्</a>
        
        <!-- Text Selector Dropdown -->
        <div class="text-selector-wrapper">
          <button class="text-selector-btn" id="text-selector-btn">
            <span class="selector-label">{activeText ? texts.find(t => t.id === activeText)?.name || 'ग्रन्थाः' : 'ग्रन्थाः'}</span>
            <svg class="selector-arrow" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
            </svg>
          </button>
          <div class="text-dropdown hidden" id="text-dropdown">
            {texts.map(text => (
              <a 
                href="#" 
                class={`text-option ${activeText === text.id ? 'active' : ''}`}
                data-text={text.id}
                data-default-path={text.path}
              >
                <span class={`option-badge ${text.id}-badge`}>{text.id.toUpperCase()}</span>
                <div class="option-text">
                  <span class="option-name">{text.name}</span>
                  <span class="option-name-en">{text.nameEn}</span>
                </div>
                {activeText === text.id && <span class="option-check">✓</span>}
              </a>
            ))}
          </div>
        </div>

        {activeText === 'ts' && (
          <>
            <a href={`${base}ts/panchasat-index`} class="nav-link">पञ्चशत् सूची</a>
          </>
        )}
        <a href={`${base}search`} class="nav-link">अन्वेषणम्</a>
      </div>
    </nav>
    
    <script>
      // Text selector dropdown with position memory
      document.addEventListener('DOMContentLoaded', () => {
        const btn = document.getElementById('text-selector-btn');
        const dropdown = document.getElementById('text-dropdown');
        const STORAGE_KEY = 'yajurveda-last-position';
        
        // Save current position to localStorage
        function savePosition() {
          const path = window.location.pathname;
          const positions = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
          
          // Detect which text we're in
          if (path.includes('/ts/')) {
            positions.ts = path;
          } else if (path.includes('/tb/')) {
            positions.tb = path;
          } else if (path.includes('/ta/')) {
            positions.ta = path;
          }
          
          localStorage.setItem(STORAGE_KEY, JSON.stringify(positions));
        }
        
        // Get saved position for a text
        function getSavedPosition(textId: string): string | null {
          const positions = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
          return positions[textId] || null;
        }
        
        // Save position on page load
        savePosition();
        
        // Toggle dropdown
        btn?.addEventListener('click', (e) => {
          e.stopPropagation();
          dropdown?.classList.toggle('hidden');
          btn.classList.toggle('open');
        });
        
        // Close on outside click
        document.addEventListener('click', () => {
          dropdown?.classList.add('hidden');
          btn?.classList.remove('open');
        });
        
        // Handle option clicks - navigate to saved position or default
        dropdown?.querySelectorAll('.text-option').forEach(option => {
          option.addEventListener('click', (e) => {
            e.preventDefault();
            const textId = (option as HTMLElement).dataset.text;
            const defaultPath = (option as HTMLElement).dataset.defaultPath;
            
            if (textId) {
              const savedPath = getSavedPosition(textId);
              window.location.href = savedPath || defaultPath || '/';
            }
          });
        });
      });
    </script>

    <main class="max-w-6xl mx-auto px-4 py-8">
      <slot />
    </main>

    <footer class="mt-auto py-6 text-center text-sm text-gray-600 border-t border-teal-200">
      <p>यजुर्वेद - Preserving ancient wisdom</p>
      <p class="mt-2"><a href={`${base}docs`} class="text-primary hover:underline">Documentation & Features</a></p>
    </footer>
  </body>
</html>

<style is:global>
  @import '../styles/global.css';
  
  .header-logo-placeholder {
    display: flex;
    width: 100px;
    height: 100px;
    margin: 0 auto 20px;
    border-radius: 50%;
    background: rgba(255,255,255,0.15);
    border: 3px solid rgba(255,255,255,0.3);
    align-items: center;
    justify-content: center;
    font-family: 'AdiShilaVedic', serif;
    font-size: 48px;
    color: white;
  }
</style>
